{"version":3,"file":"index.es.js","sources":["../src/get-options.js","../src/color-to-vec4.js","../src/shaders.js","../src/geometry.js","../src/utils.js","../src/metaballs.js","../src/interactive.js","../src/index.js"],"sourcesContent":["const defaultOptions = {\n  numMetaballs: 100,\n  minRadius: 3,\n  maxRadius: 7.5,\n  speed: 10.0,\n  color: '#ff0024',\n  backgroundColor: '#121212',\n  useDevicePixelRatio: true,\n  interactive: false\n}\n\nexport default function getOptions(passedOptions) {\n  const mergedOptions = Object.keys(defaultOptions).reduce(\n    (acc, key) =>\n      Object.assign(acc, {\n        [key]:\n          passedOptions[key] !== undefined\n            ? passedOptions[key]\n            : defaultOptions[key]\n      }),\n    {}\n  )\n\n  return mergedOptions\n}\n","export default color => {\n  const isValid = /^#[0-9A-F]{6,8}$/i.test(color)\n\n  if (!isValid) {\n    throw new Error(\n      `${color} is not a valid hex color. Must be a 6 (8) character hex (+alpha) color.`\n    )\n  }\n\n  const hexChannels = [\n    color.slice(1, 3),\n    color.slice(3, 5),\n    color.slice(5, 7),\n    color.slice(7, 9)\n  ]\n  const unitChannels = hexChannels\n    .map(hex => Number.parseInt(hex, '16'))\n    .map(val => val / 0xff)\n  if (!Number.isFinite(unitChannels[3])) unitChannels[3] = 1.0\n\n  return unitChannels\n}\n","import colorToVec4 from './color-to-vec4'\n\nexport default function shaders({ gl, options }) {\n  // Utility to fail loudly on shader compilation failure\n  function compileShader(shaderSource, shaderType) {\n    const shader = gl.createShader(shaderType)\n    gl.shaderSource(shader, shaderSource)\n    gl.compileShader(shader)\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      throw new Error(\n        `Shader compile failed with: ${gl.getShaderInfoLog(shader)}`\n      )\n    }\n\n    return shader\n  }\n\n  const vertexShader = compileShader(\n    `\nattribute vec2 position;\n\nvoid main() {\n    // position specifies only x and y.\n    // We set z to be 0.0, and w to be 1.0\n    gl_Position = vec4(position, 0.0, 1.0);\n}\n`,\n    gl.VERTEX_SHADER\n  )\n\n  const numMetaballs = options.numMetaballs + (options.interactive ? 1 : 0)\n  const colorVec4 = colorToVec4(options.color)\n  const backgroundColorVec4 = colorToVec4(options.backgroundColor)\n  const fragmentShader = compileShader(\n    `\nprecision highp float;\nuniform vec2 windowSize;\nuniform vec3 metaballs[${numMetaballs}];\n\nvoid main(){\n    // scaling from [0,100] to [0, canvasWidth/Height]\n    float radiusMultiplier = min(windowSize.x, windowSize.y) / 200.0;\n    float xMultiplier = windowSize.x / 100.0;\n    float yMultiplier = windowSize.y / 100.0;\n\n    float x = gl_FragCoord.x;\n    float y = gl_FragCoord.y;\n    float v = 0.0;\n    for (int i = 0; i < ${numMetaballs}; i++) {\n        vec3 mb = metaballs[i];\n        float dx = abs((mb.x * xMultiplier) - x);\n        // width - dx is needed for the wrap-around-the-edges logic\n        dx = min(dx, windowSize.x - dx);\n        float dy = abs((mb.y * yMultiplier) - y);\n        // height - dy is needed for the wrap-around-the-edges logic\n        dy = min(dy, windowSize.y - dy);\n        float r = mb.z * radiusMultiplier;\n        v += r*r/(dx*dx + dy*dy);\n    }\n    if (v > 1.0) {\n        gl_FragColor = vec4(${colorVec4.join(', ')});\n    } else {\n        gl_FragColor = vec4(${backgroundColorVec4.join(', ')});\n    }\n}\n`,\n    gl.FRAGMENT_SHADER\n  )\n\n  return {\n    vertexShader,\n    fragmentShader\n  }\n}\n","export default function geometry({ gl, program }) {\n  // Set up 4 vertices, which we'll draw as a rectangle\n  // via 2 triangles\n  //\n  //   A---C\n  //   |  /|\n  //   | / |\n  //   |/  |\n  //   B---D\n  //\n  // We order them like so, so that when we draw with\n  // gl.TRIANGLE_STRIP, we draw triangle ABC and BCD.\n  var vertexData = new Float32Array([\n    -1.0,\n    1.0, // top left\n    -1.0,\n    -1.0, // bottom left\n    1.0,\n    1.0, // top right\n    1.0,\n    -1.0 // bottom right\n  ])\n  var vertexDataBuffer = gl.createBuffer()\n  gl.bindBuffer(gl.ARRAY_BUFFER, vertexDataBuffer)\n  gl.bufferData(gl.ARRAY_BUFFER, vertexData, gl.STATIC_DRAW)\n\n  /**\n   * Attribute setup\n   */\n\n  // Utility to complain loudly if we fail to find the attribute\n\n  function getAttribLocation(program, name) {\n    var attributeLocation = gl.getAttribLocation(program, name)\n    if (attributeLocation === -1) {\n      throw new Error(`Can not find attribute ${name}.`)\n    }\n    return attributeLocation\n  }\n\n  // To make the geometry information available in the shader as attributes, we\n  // need to tell WebGL what the layout of our data in the vertex buffer is.\n  const positionHandle = getAttribLocation(program, 'position')\n  gl.enableVertexAttribArray(positionHandle)\n  gl.vertexAttribPointer(\n    positionHandle,\n    2, // position is a vec2\n    gl.FLOAT, // each component is a float\n    gl.FALSE, // don't normalize values\n    2 * 4, // two 4 byte float components per vertex\n    0 // offset into each span of vertex data\n  )\n}\n","// Utility to complain loudly if we fail to find the uniform\nexport function getUniformLocation({ gl, program, name }) {\n  const uniformLocation = gl.getUniformLocation(program, name)\n  if (uniformLocation === -1) {\n    throw new Error(`Can not find uniform ${name}.`)\n  }\n  return uniformLocation\n}\n","import { getUniformLocation } from './utils'\n\nconst createMetaballs = ({ options }) => {\n  return Array.from(\n    { length: options.numMetaballs + (options.interactive ? 1 : 0) },\n    () => {\n      const radius =\n        options.minRadius +\n        Math.random() * (options.maxRadius - options.minRadius)\n      return {\n        x: Math.random() * (100 - radius / 100) + radius / 200,\n        y: Math.random() * (100 - radius / 100) + radius / 200,\n        vx: ((Math.random() - 0.5) * 2 * options.speed) / 100,\n        vy: ((Math.random() - 0.5) * 2 * options.speed) / 100,\n        r: radius\n      }\n    }\n  )\n}\n\nconst simulateMovement = ({ metaballs, options }) => {\n  // don't move last interactive cursor metaball\n  if (options.interactive) metaballs = metaballs.slice(0, -1)\n\n  metaballs.forEach(mb => {\n    mb.x += mb.vx\n    if (mb.x < 0) {\n      mb.x = 100 - mb.x\n    } else if (mb.x > 100) {\n      mb.x = mb.x - 100\n    }\n    mb.y += mb.vy\n    if (mb.y < 0) {\n      mb.y = 100 - mb.y\n    } else if (mb.y > 100) {\n      mb.y = mb.y - 100\n    }\n  })\n}\n\nconst getMetaballsHandle = ({ gl, program }) => {\n  const metaballsHandle = getUniformLocation({ gl, program, name: 'metaballs' })\n  return metaballsHandle\n}\n\nexport { createMetaballs, getMetaballsHandle, simulateMovement }\n","export default function initInteractive({ options, gl }) {\n  const { interactive } = options\n\n  if (interactive && ![`window`, `canvas`].includes(interactive)) {\n    throw new Error(\n      `options.interactive must be one of \"false\", \"'window'\", or \"'canvas'\". Provided \"${interactive}\" (${typeof interactive}).`\n    )\n  }\n\n  let cursorPos = {\n    x: 0,\n    y: 0\n  }\n\n  function cursorMoveCanvas(e) {\n    cursorPos.x = (e.offsetX || e.clientX) / gl.canvas.clientWidth\n    cursorPos.y = (e.offsetY || e.clientY) / gl.canvas.clientHeight\n    cursorPos.x = cursorPos.x * 100\n    cursorPos.y = (1 - cursorPos.y) * 100\n  }\n\n  function cursorMoveWindow(e) {\n    cursorPos.x = e.clientX / gl.canvas.clientWidth\n    cursorPos.y = e.clientY / gl.canvas.clientHeight\n    cursorPos.x = cursorPos.x * 100\n    cursorPos.y = (1 - cursorPos.y) * 100\n  }\n\n  let cursorMove = () => null\n  let unsubscribe = () => null\n\n  if (interactive) {\n    if (interactive === `window`) {\n      cursorMove = cursorMoveWindow\n      window.addEventListener('mousemove', cursorMove)\n      unsubscribe = () => window.removeEventListener('mousemove', cursorMove)\n    } else if (interactive === `canvas`) {\n      cursorMove = cursorMoveCanvas\n      gl.canvas.addEventListener('mousemove', cursorMove)\n      unsubscribe = () => gl.canvas.removeEventListener('mousemove', cursorMove)\n    }\n  }\n\n  return {\n    cursorPos,\n    unsubscribe\n  }\n}\n","import getOptions from './get-options'\nimport shaders from './shaders'\nimport geometry from './geometry'\nimport {\n  createMetaballs,\n  getMetaballsHandle,\n  simulateMovement\n} from './metaballs'\nimport { getUniformLocation } from './utils'\nimport initInteractive from './interactive';\n\nexport default function initMetaballs(canvas, passedOptions = {}) {\n  const options = getOptions(passedOptions)\n\n  if (typeof canvas === 'string') {\n    canvas = document.querySelector(canvas)\n  }\n  if (\n    !(canvas instanceof window.Element) ||\n    canvas.tagName.toLowerCase() !== 'canvas'\n  ) {\n    throw new Error(\n      `First argument of \"initMetaballs\" must be a valid canvas element or a selector to an existing canvas element.`\n    )\n  }\n\n  /**\n   * Shaders setup\n   */\n  const gl = canvas.getContext('webgl')\n  const { vertexShader, fragmentShader } = shaders({ gl, options })\n\n  const program = gl.createProgram()\n  gl.attachShader(program, vertexShader)\n  gl.attachShader(program, fragmentShader)\n  gl.linkProgram(program)\n  gl.useProgram(program)\n\n  /**\n   * Canvas & Metaballs setup\n   */\n  geometry({ gl, program })\n\n  // resize handler\n  const resize = () => {\n    const realToCSSPixels = options.useDevicePixelRatio\n      ? window.devicePixelRatio\n      : 1\n\n    // Lookup the size the browser is displaying the canvas in CSS pixels\n    // and compute a size needed to make our drawingbuffer match it in\n    // device pixels.\n    const displayWidth = Math.floor(gl.canvas.clientWidth * realToCSSPixels)\n    const displayHeight = Math.floor(gl.canvas.clientHeight * realToCSSPixels)\n\n    // Check if the canvas is not the same size.\n    if (\n      gl.canvas.width !== displayWidth ||\n      gl.canvas.height !== displayHeight\n    ) {\n      // Make the canvas the same size\n      gl.canvas.width = displayWidth\n      gl.canvas.height = displayHeight\n      gl.viewport(0, 0, gl.canvas.width, gl.canvas.height)\n    }\n  }\n\n  // user might now have set correct canvasWidth / canvasHeight\n  resize()\n\n  const metaballs = createMetaballs({\n    options\n  })\n  const metaballsHandle = getMetaballsHandle({ gl, program })\n\n  // get windowSize uniform\n  const windowSizeHandle = getUniformLocation({\n    gl,\n    program,\n    name: 'windowSize'\n  })\n\n  /**\n   * Simulation step, data transfer, and drawing\n   */\n  const { cursorPos, unsubscribe: unsubscribeInteractive } = initInteractive({ options, gl })\n\n  let run = true\n  const step = function() {\n    const canvasWidth = gl.canvas.width\n    const canvasHeight = gl.canvas.height\n    // Update positions and speeds\n    simulateMovement({ metaballs, options })\n\n    // To send the data to the GPU, we first need to\n    // flatten our data into a single array.\n    const dataToSendToGPU = new Float32Array(3 * metaballs.length)\n    metaballs.forEach((mb, i) => {\n      const baseIndex = 3 * i\n      dataToSendToGPU[baseIndex + 0] = mb.x\n      dataToSendToGPU[baseIndex + 1] = mb.y\n      dataToSendToGPU[baseIndex + 2] = mb.r\n    })\n\n    if (options.interactive) {\n      // overwrite last metaball's position with cursor\n      const baseIndex = 3 * (metaballs.length - 1)\n      dataToSendToGPU[baseIndex + 0] = cursorPos.x\n      dataToSendToGPU[baseIndex + 1] = cursorPos.y\n      dataToSendToGPU[baseIndex + 2] = options.maxRadius\n    }\n\n    gl.uniform3fv(metaballsHandle, dataToSendToGPU)\n    gl.uniform2fv(\n      windowSizeHandle,\n      Float32Array.from({ length: 2 }, (_, index) =>\n        index === 0 ? canvasWidth : canvasHeight\n      )\n    )\n\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4)\n\n    if (run) window.requestAnimationFrame(step)\n  }\n\n  step()\n  window.addEventListener('resize', resize)\n\n  const destroy = () => {\n    run = false\n    window.removeEventListener('resize', resize)\n    unsubscribeInteractive()\n  }\n  return destroy\n}\n"],"names":["defaultOptions","numMetaballs","minRadius","maxRadius","speed","color","backgroundColor","useDevicePixelRatio","interactive","getOptions","passedOptions","mergedOptions","Object","keys","reduce","acc","key","assign","undefined","isValid","test","Error","hexChannels","slice","unitChannels","map","hex","Number","parseInt","val","isFinite","shaders","gl","options","compileShader","shaderSource","shaderType","shader","createShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","vertexShader","VERTEX_SHADER","colorVec4","colorToVec4","backgroundColorVec4","fragmentShader","join","FRAGMENT_SHADER","geometry","program","vertexData","Float32Array","vertexDataBuffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","getAttribLocation","name","attributeLocation","positionHandle","enableVertexAttribArray","vertexAttribPointer","FLOAT","FALSE","getUniformLocation","uniformLocation","createMetaballs","Array","from","length","radius","Math","random","x","y","vx","vy","r","simulateMovement","metaballs","forEach","mb","getMetaballsHandle","metaballsHandle","initInteractive","includes","cursorPos","cursorMoveCanvas","e","offsetX","clientX","canvas","clientWidth","offsetY","clientY","clientHeight","cursorMoveWindow","cursorMove","unsubscribe","window","addEventListener","removeEventListener","initMetaballs","document","querySelector","Element","tagName","toLowerCase","getContext","createProgram","attachShader","linkProgram","useProgram","resize","realToCSSPixels","devicePixelRatio","displayWidth","floor","displayHeight","width","height","viewport","windowSizeHandle","unsubscribeInteractive","run","step","canvasWidth","canvasHeight","dataToSendToGPU","i","baseIndex","uniform3fv","uniform2fv","_","index","drawArrays","TRIANGLE_STRIP","requestAnimationFrame","destroy"],"mappings":"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"}